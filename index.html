<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="http://cdn.webix.com/edge/webix.js"></script>
    <link rel="stylesheet" type="text/css" href="http://cdn.webix.com/edge/webix.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.materialdesignicons.com/2.7.94/css/materialdesignicons.css">
    <title>Webix | Task 1</title>
    <style>
        .webix_toolbar.webix_dark .webix_secondary button {
            background: none;
        }
        

        .label {
            color: #fff;
        }

        .side, .side > div {
            background-color: #EEEEEE;
        }

        .connected {
            text-align: center;
            color: green;
        }

        .footer__description {
            text-align: center;
        }
    </style>
</head>
<body>
    
    <script type="module" charset="utf-8">
        import { small_film_set } from './testdata.js';

        let header = {
            view: 'toolbar',
            height: 70,
            css: 'webix_dark',
            paddingX: 15,
            elements: [
                { view: 'label', label: "<span class='label'>My App</span>" },
                {},
                {
                    view: 'button',
                    id: 'Profile',
                    type: 'icon',
                    icon: 'mdi mdi-account',
                    maxWidth: 150,
                    label: 'Profile',
                    popup: 'profile_popup'
                }
            ]
        };

        let side = {
            css: 'side',
            rows: [
                {
                    view: 'list',
                    borderless: true,
                    autoheight: true,
                    type: 'clean',
                    data: [ 'Dashboard', 'Users', 'Products', 'Locations' ]
                },
                {},
                {
                    view: 'template',
                    height: 50,
                    css: 'connected',
                    borderless: true,
                    template: "<p><span class='webix_icon wxi-check'></span> Connected</p>"
                }
            ]
        };

        let resizer = { view: 'resizer' };

        let moviesTable = {
            view: 'datatable',
            id: 'movies_table',
            gravity: 3,
            scroll: 'y',
            autoConfig: true,
            data: small_film_set
        };

        let buttons = [
            {
                view: 'button',
                css: 'webix_primary',
                value: 'Add New',
                click: function() {
                    if ($$('movies_form').validate()) {
                        var item = $$('movies_form').getValues();
                        $$('movies_table').add(item);
                        webix.message({ type: 'success', text: 'The movie is added' });
                    }
                }
            },
            {
                view: 'button',
                value: 'Clear',
                click: function() {
                    webix.confirm({
                        text:"Are you sure you want to clean the form?"
                    }).then(
                        function(){
                            $$('movies_form').clear();
                        }, 
                        function(){
                            webix.message("Rejected");
                        }
                    );
                }
            }
        ];

        let form = {
            view: 'toolbar',
            gravity: 1.5,
            rows: [
                {
                    view: 'form',
                    id: 'movies_form',
                    borderless: true,
                    elements: [
                        { type: 'section', template: 'Icon buttons', borderless: true },
                        { view: 'text', name: 'title', label: 'Title', invalidMessage: 'Please, enter the name of a movie' },
                        {
                            view: 'text',
                            name: 'year',
                            label: 'Year',
                            invalidMessage: 'Enter year should be between 1970 and current year'
                        },
                        { view: 'text', name: 'rating', label: 'Rating', invalidMessage: 'Enter rating can not be empty or 0' },
                        { view: 'text', name: 'votes', label: 'Votes', invalidMessage: 'Enter vote must be less than 100000' },
                        { margin: '20', cols: webix.copy(buttons) }
                    ],
                    rules: {
                        title: webix.rules.isNotEmpty,
                        year: function(value) {
                            let currentYear = new Date().getFullYear();
                            return value > 1970 && value < currentYear;
                        },
                        votes: function(value) {
                            if (value !== '') {
                                return value < 100000;
                            }
                            return false;
                        },
                        rating: function(value) {
                            if (value == '' || isNaN(value)) {
                                return false;
                            }
                            return value != 0;
                        }
                    }
                }
            ]
        };

        let footer = {
            id: 'footer',
            height: 60,
            css: 'footer__description',
            view: 'template',
            template:
                "<p>The software is provided by <a href='https://webix.com'>https://webix.com</a>. All rights reserved (c)</p>"
        };

        webix.ui({
            view: 'popup',
            id: 'profile_popup',
            body: {
                view: 'list',
                autoheight: true,
                data: [ 'Settings', 'Log out' ]
            }
        });

        webix.ui({
            rows: [
                header,
                {
                    cols: [ side, resizer, moviesTable, form ]
                },
                footer
            ]
        });

      </script>
</body>
</html>